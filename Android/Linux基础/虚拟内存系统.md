#### 虚拟内存适用的场景和目的

用于进程的内存分配

#### 虚拟内存的大小

32位可以描述的大小为：2^32 = 4GB

#### 进程的内存分配对应的物理内存是什么？电脑内存条对应的内存？CPU的多级缓存？SSD？机械磁盘？

对应的是CPU直接操作的内存，如电脑的内存条，手机上如4G、8G、16G等这样所谓的“运行内存”

#### 设备的内存本来就紧张，为什么设计虚拟内存系统？

在多任务的设备上，多个进程执行的时候，如果直接操作物理内存，可能会导致多个进程访问同一段内存使程序异常，如果给每一个进程开辟一个较大空间的私有的空间，隔离每一个进程的内存访问，就可以高效、安全的管理进程内存的使用，至于怎么实现的，使用进程的地方不用关心，只需要关心开辟的虚拟内存怎么使用。

#### 那虚拟内存主要的作用是什么？

* 缓存：比如一个进程访问本地文件，声明一个变量来保存从物理磁盘上读取的数据
* 内存保护：私有的内存，怎么操作都是别的进程无法访问的
* 内存管理：如何做到进程对内存的使用

#### 内存分页的目的

基于虚拟内存的技术，虚拟内存和物理内存可定是某种对应关系，通过这种对应关系来给保证进程的内存使用，而且这种对应关系是被加载到内存中实时可被cpu执行运算的，如果是一个8G的PC，每一个字节Byte都包含一个对应关系，假如一个对应关系仅仅是1.5倍内存占用，那么就有8G*1.5就有12G，远超过原有内存，并且cpu还要实时运算每一个对应关系，那肯定就瘫痪了，如果把8G分成很多段，就像把几百万的小说分成很多页来展示一样，这样虚拟内存和物理内存的映射关系就给书的页码一样，如果4KB的大小对应一个内存页，这样逻辑映射关系占用的内存就缩小了4096倍，按照之前占用12G的假设，缩小4096倍之后则只需要3M的空间解释虚拟内存和物理内存的关系

#### 进程是如何占用物理内存的？

虽然有了虚拟内存系统，让进程有了私有的内存空间，但是进程最终使用的还是物理内存，只是中间经过了虚拟内存系统的管理。实际上虚拟内存通过缺页中断为进程分配物理内存。

#### 进程太多，物理内存不够了怎么办？

使用PC的都知道，当进程开启太多，打开资源管理器会看到内存的占用也会很多，因为进程肯定会占用物理内存的。如果多个进程占用过多内存，此时又必须开启一个必要进程怎么办？在Linux操作系统上编译Android aosp的时候，由于编译过程进程多，IO量大，往往导致8G内存的PC出现内存不够的情况，此时Google提出解决办法，配置若干的Swap分区解决，Swap分区可以利用磁盘来存储一些进程不常使用的缓存，利用损失IO效率的方式（也损失不到多少，不常用的内存，IO操作也就不频繁），给其他进程提供内存。

#### Linux进程分配的虚拟内存包含哪些重要部分？

* 内核内存占用：进程始终有内核态，比如在进行一些系统调用的时候会切入内核态，说明肯定有内核态需要的一些内存占用
* 栈：用于存放局部变量、函数参数等临时的一些内存占用
* 内存映射段：mmap，将文件磁盘直接映射到内存，多用于装载动态共享库
* 堆：动态分配的内存存放，如malloc、new函数调用，动态分配的内存都需要释放
* 数据段：如声明的全局已经赋值的变量、常量
* bss段：如全局非初始化变量
* 代码段